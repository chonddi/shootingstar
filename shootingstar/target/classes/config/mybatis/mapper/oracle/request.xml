<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.request">
	
	
	<sql id="requestCol">
		rqno, memberid, cgno, rqprice, rqregion, rqdate,
		rqtype, pickcount, rqdetail, regdate, delflag
	</sql>
	
	<sql id="searchWhere">
		<if test="searchKeyword !=null and searchKeyword !=''">
			<where>
				${searchCondition} like '%' || #{searchKeyword} || '%'
			</where>
		</if>
	</sql>
	
	<insert id="insertRequest" parameterType="RequestVO">
		<selectKey keyProperty="RQNo" order="BEFORE" resultType="int">
			select request_seq.nextval from dual
		</selectKey>
		insert into request(rqno, memberid, cgno, rqprice, rqregion, rqdate, rqtype, rqdetail) 
		values(#{RQNo}, 'gg', #{cgNo}, #{RQPrice}, #{RQRegion} ,#{RQDate}, #{RQType}, #{RQDetail})
	</insert>

	<insert id="insertReqImg" parameterType="RequestImgVO">
		insert into requestimg(rqimgno, rqno, originalfilename, filename) 
		values(requestimg_seq.nextval, #{RQNo}, #{originalFileName}, #{fileName})
	</insert>


	<select id="selectAll" parameterType="ctgRequestVO" resultType="RequestVO">
		select *
		from
		(
		    select rownum as RNUM, list.*
		    from (
		    	<choose>
			        <when test="cgNo==null or cgNo==''">
		        select 
				<include refid="requestCol"></include>		
				 from request
				<include refid="searchWhere"></include>
				
				</when>
					<otherwise>		
						select 
						<include refid="requestCol"></include>		
						 from request
						where cgNo=#{cgNo}
					</otherwise>			
				</choose>
				order by rqno desc	
				
		    )list
		)    
		<![CDATA[
		where RNUM>#{firstRecordIndex} 
		and RNUM<=#{firstRecordIndex}+#{recordCountPerPage}
		]]>
	</select>
	
	
	
	<select id="getTotalRecord" parameterType="ctgRequestVO" resultType="int">
		<choose>
	         <when test="cgNo==null or cgNo==''">
		        select count(*)	
				 from request
				<include refid="searchWhere"></include>			
			</when>
			<otherwise>				
				select count(*)		
				 from request
				where cgNo=#{cgNo}
			</otherwise>			
		</choose>
			
	</select>
	
	
	<select id="selectByNo" parameterType="int" resultType="RequestVO">
		select * from request where RQNo=#{RQNo}
	</select>

	<select id="selectByNoImg" parameterType="int" resultType="RequestImgVO">
		select * from requestimg where RQNo=#{RQNo}
	</select>

	
</mapper>









